# 开发规则和约定

## 📋 核心开发规则

### 1. 代码模块化原则
- **规则**: 代码尽可能模块化，避免单个文件过大
- **执行标准**: 
  - 单个文件不超过 500 行代码
  - 功能相关的代码组织在同一模块
  - 使用清晰的文件夹结构分类

### 2. 临时文件管理规则
- **规则**: `temp/` 目录下的内容是临时文件
- **注意事项**: 
  - 这些文件可能随时删除，不会提前通知
  - 需要将有用内容及时迁移到合适位置
  - 不要在临时目录中存放重要文件

### 3. 测试文件隔离规则
- **规则**: 所有测试文件都要在单独的目录下
- **目录结构**:
  ```
  tests/
  ├── unit/           # 单元测试
  ├── integration/    # 集成测试
  ├── fixtures/       # 测试数据
  ├── scripts/        # 测试脚本
  ├── config/         # 测试配置
  └── temp/           # 临时测试文件
  ```

### 4. 上线清理规则
- **规则**: 上线前要手动清理测试文件
- **执行命令**: `pnpm run cleanup`
- **重要变更**: 自动清理的prebuild钩子已移除，需要手动执行清理

### 5. 规则遵循原则
- **规则**: 严格按照约定的规则执行开发
- **记录要求**: 所有规则变更都要有文档记录
- **执行监督**: 定期检查规则执行情况

## 🎯 执行检查清单

### 开发前检查
- [ ] 确认临时文件已迁移
- [ ] 检查代码模块化程度
- [ ] 验证测试文件位置

### 开发中检查
- [ ] 新增文件符合模块化要求
- [ ] 测试文件放在正确目录
- [ ] 避免在临时目录存放重要文件

### 上线前检查
- [ ] **手动运行** `pnpm run cleanup` 清理测试文件
- [ ] 确认所有临时文件已处理
- [ ] 验证项目结构清洁

## 🔧 相关工具和命令

### 清理命令
```bash
# 手动清理测试文件（必须手动执行）
pnpm run cleanup

# 构建项目（不再自动清理）
pnpm build

# 运行测试
pnpm test
```

### 目录检查
```bash
# 检查项目结构
ls -la

# 检查测试目录
ls -la tests/

# 检查临时目录
ls -la temp/
```

## 📝 规则更新记录

- **2025-01-19**: 移除prebuild自动清理钩子，改为手动清理模式
- **2025-01-19**: 初始规则制定
- **规则来源**: 用户约定的5条开发规则
- **适用范围**: 整个项目开发周期

## ⚠️ 重要变更说明

### prebuild钩子移除
- **变更**: 移除了package.json中的`"prebuild": "pnpm run cleanup"`钩子
- **影响**: 构建时不再自动清理测试文件
- **新流程**: 开发者需要在构建前手动运行`pnpm run cleanup`
- **原因**: 简化构建流程，给开发者更多控制权

### 新的构建流程
```bash
# 推荐的构建流程
pnpm run cleanup  # 手动清理测试文件
pnpm build        # 构建项目
pnpm start        # 启动生产服务器
```