# 🛡️ 中文水印功能使用指南

## 🎯 功能概述

现在系统支持在PDF中添加中文水印！我们实现了多层级的字体加载策略，确保中文字符能够正确显示。

## 🔧 字体加载策略

### 方案1：本地字体文件（推荐）
系统会优先尝试加载本地字体文件：

```
public/fonts/
├── NotoSansSC-Regular.ttf     # Google Noto 中文字体
├── SourceHanSansSC-Regular.ttf # Adobe 思源黑体
└── chinese-font.ttf           # 自定义中文字体
```

### 方案2：CDN在线字体
如果本地字体不可用，系统会从CDN加载：
- Google Fonts CDN
- jsDelivr CDN

### 方案3：系统字体备用
最后会使用系统内置字体作为备用方案。

## 🚀 快速开始

### 1. 下载中文字体（推荐）

运行字体下载脚本：
```bash
node scripts/download-chinese-fonts.js
```

这会自动下载并安装中文字体到 `public/fonts/` 目录。

### 2. 手动安装字体

如果自动下载失败，可以手动下载字体文件：

1. **Noto Sans SC** (推荐)
   - 下载地址: https://fonts.google.com/noto/specimen/Noto+Sans+SC
   - 文件名: `NotoSansSC-Regular.ttf`

2. **思源黑体**
   - 下载地址: https://github.com/adobe-fonts/source-han-sans
   - 文件名: `SourceHanSansSC-Regular.ttf`

将下载的字体文件放入 `public/fonts/` 目录。

### 3. 测试中文水印

1. 访问测试页面: `http://localhost:3000/watermark-test`
2. 点击"测试水印功能"按钮
3. 查看控制台日志，确认字体加载状态

## 🎨 使用中文水印

### 在水印设置中使用中文

1. **打开水印设置**
   - 点击"水印设置"按钮

2. **输入中文水印文本**
   ```
   星光传媒
   机密文档
   内部资料
   版权所有
   禁止复制
   ```

3. **调整水印参数**
   - 透明度: 10-50% (推荐30%)
   - 字体大小: 48-72px
   - 旋转角度: 30-45度
   - 重复模式: 对角线或网格

4. **导出PDF**
   - 启用水印后导出PDF
   - 文件名会自动添加"_protected"后缀

## 📊 字体加载日志

正常的字体加载过程会显示以下日志：

```
🔤 开始加载中文字体...
📁 找到本地字体文件: /fonts/NotoSansSC-Regular.ttf
✅ 本地中文字体加载成功
✅ 中文水印添加成功
```

如果遇到问题，会显示：

```
⚠️ 本地字体文件不存在: /fonts/NotoSansSC-Regular.ttf
🌐 尝试从CDN加载字体...
✅ CDN字体加载成功，大小: 2048576 bytes
```

## 🔍 故障排除

### 问题1: 中文字符显示为方框
**原因**: 字体文件未正确加载
**解决**: 
1. 检查 `public/fonts/` 目录是否有字体文件
2. 运行字体下载脚本
3. 检查网络连接（CDN字体需要）

### 问题2: 水印不显示
**原因**: 字体加载失败，回退到英文
**解决**:
1. 查看控制台错误日志
2. 确认字体文件格式正确（.ttf, .otf, .woff2）
3. 尝试使用英文水印测试基础功能

### 问题3: 字体文件过大
**原因**: 完整的中文字体文件通常较大（2-10MB）
**解决**:
1. 使用子集字体（只包含常用字符）
2. 使用CDN字体（按需加载）
3. 压缩字体文件

## 💡 最佳实践

### 1. 字体选择
- **推荐**: Noto Sans SC (Google开源，支持完整)
- **备选**: 思源黑体 (Adobe开源，质量高)
- **避免**: 商业字体 (版权问题)

### 2. 水印文本
- **简洁明了**: 2-6个字符最佳
- **常用词汇**: 机密、内部、草稿、样本
- **公司信息**: 公司名称、部门名称

### 3. 视觉效果
- **透明度**: 30%左右，既可见又不影响阅读
- **大小**: 48-64px，根据页面大小调整
- **位置**: 对角线重复，覆盖面广

### 4. 性能优化
- **本地字体**: 首次加载后缓存，速度快
- **CDN字体**: 需要网络，但无需本地存储
- **字体子集**: 只包含需要的字符，文件更小

## 🎉 支持的中文水印示例

系统已预设常见中文水印的处理：

| 中文水印 | 英文备用 | 使用场景 |
|---------|---------|---------|
| 机密文档 | CONFIDENTIAL | 内部文件 |
| 内部资料 | INTERNAL | 公司资料 |
| 草稿 | DRAFT | 草稿文档 |
| 样本 | SAMPLE | 样本展示 |
| 星光传媒 | Starlight Media | 公司水印 |
| 版权所有 | Copyright | 版权保护 |
| 禁止复制 | Do Not Copy | 防复制 |

现在你可以放心使用中文水印功能了！🚀